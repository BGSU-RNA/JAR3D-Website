{% extends "JAR3Doutput/base_result.html" %}
{% load staticfiles %}

{% block page_specific_css_class %}results-done{% endblock page_specific_css_class %}

{% block custom_css %}
  <link rel="stylesheet" href="{% static "js/fancybox/jquery.fancybox.css" %}" type="text/css" media="screen" />
{% endblock custom_css %}

{% block page_subtitle %}
  {{ block.super }}
  Query {{ query_info.query_id }} completed
{% endblock page_subtitle %}


{% block page_content %}

{{ block.super }}

<div class="row">
{% for loop,sequences,indices in results %}
    <div class="span8">
    <h3>
    Loop {{ forloop.counter }}
    </h3>
    Column Numbers {{ indices }}
    <div style="height:60px;width:360px;border:1px solid #ccc;font:16px/26px Georgia, Garamond, Serif;overflow:auto;">
      {% for seq in sequences %}
          {{ seq }}<br>
      {% endfor %}

    </div>

    <table class="table table-striped table-condensed table-bordered">
      <thead>
        <tr>
          <th>#</th>
          <th>Motif</th>
          <th>Percent Accepted by Model</th>
          <th>Mean Alignment Score</th>
          <th>Full Edit Distance</th>
          <th>Interior Edit Distance</th>
          <th>Basepair Signature</th>
        </tr>
      </thead>
      <tbody>
      {% for result in loop %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <td class="hover-link">
          <input type='radio' name="group" id='s{{ forloop.parentloop.counter }}-{{ forloop.counter }}'
                 class='jmolInline' data-coord='{{ result.motif_id }}'>
          <label for='s{{ forloop.parentloop.counter }}-{{ forloop.counter }}'>{{ result.motif_id }}</label>
          <span class="link-icon">
            <a href="{{ result.motif_url }}" target="_blank">&rarr;</a>
          </span>
          <a class="fancybox" rel="gallery" href="{{ result.ssurl }}"
               title="Loop {{ forloop.parentloop.counter }} - Hit {{ forloop.counter }} - Motif {{ result.motif_id }}">
                <img class="ss-thumbnail" src="{{ result.ssurl }}"></img>
          </a>
        </td>
        <td>{{ result.cutoff_percent|floatformat:2 }}</td>
        <td>{{ result.meanscore|floatformat:4 }}</td>
        <td>{{ result.medianfulleditdist|floatformat }}</td>
        <td>{{ result.medianinterioreditdist|floatformat }}</td>
        <td>{{ result.signature }}</td>
      </tr>
      {% endfor %}
      </tbody>
    </table>
    </div>
{% endfor %}
</div>

<div class="span4" id="jmol">
    <script src="{% static "jsmol/JSmol.min.js" %}"></script>
    <script type="text/javascript">
        function jmolScript(cmd) {Jmol.script(jmolApplet0, cmd)};
        function jmolScriptWait(cmd) {Jmol.scriptWait(jmolApplet0, cmd)};

        Jmol.getProfile();

        var jsMolSize = 340;

        var config = {
          width: jsMolSize,
          height: jsMolSize,
          debug: false,
          color: "#F0F0F0",
          addSelectionOptions: false,
          use: "HTML5",
          j2sPath: "{% static "jsmol/j2s" %}",
          isSigned: false,
          disableJ2SLoadMonitor: true,
          disableInitialConsole: true,
          allowjavascript: true,
          readyFunction: function() {
            $('.jmolInline').first().jmolToggle();
          },
        };
        jmolApplet0 = Jmol.getApplet("jmolApplet0", config);
    </script>

    <input type='button' id='neighborhood' class='btn' value="Show neighborhood">
    <input type='button' id='stereo' class='btn' value="Show stereo">
    <input type='button' id='prev' class='btn' value='Previous'>
    <input type='button' id='next' class='btn' value="Next">
    <label><input type="checkbox" id="showNtNums">Numbers</label>
</div>
{% endblock page_content%}

{% block page_specific_js %}
    {{ block.super }}
    <script src="{% static "js/jquery.tablesorter.min.js" %}"></script>
    <script src="{% static "js/jquery.jmolTools.js" %}"></script>
    <script src="{% static "js/fancybox/jquery.fancybox.pack.js" %}"></script>

    <script>
      $(document).ready(function() {
          $("table").tablesorter();

          // initialize jmolTools
          $('.jmolInline').jmolTools({
              showStereoId: 'stereo',
              showNeighborhoodId: 'neighborhood',
              showNumbersId: 'showNtNums',
              showNextId: 'next',
              showPrevId: 'prev'
          });

          // position jmol
          (function(){
              var reference = $('table').first();
              var offset_left = reference.offset().left + reference.width();
              var offset_top  = reference.offset().top;
              $('#jmol').css('position','fixed')
                        .css('left',offset_left)
                        .css('top',offset_top);
          })();

          // fancybox integration
        $(".fancybox").fancybox({
          openEffect	: 'none',
          closeEffect	: 'none'
        });

      });
    </script>

{% endblock page_specific_js %}
