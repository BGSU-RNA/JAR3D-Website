{% extends "JAR3Doutput/base_result.html" %}

{% block page_specific_css_class %}results-done{% endblock page_specific_css_class %}

{% block custom_css %}
<script src="http://rna.bgsu.edu/img/jmol/jmol.js"></script>
{% endblock custom_css %}

{% block page_subtitle %}
  {{ block.super }}
  Query {{ query_info.query_id }} completed
{% endblock page_subtitle %}


{% block page_content %}

<div class="row">
{% for loop in loops %}
    <div class="span8">
    <strong>Loop {{ forloop.counter }} - {{ loop.seqs }}</strong>
    <table class="table table-striped table-condensed table-bordered">
      <thead>
        <tr>
          <th>#</th>
          <th>Motif</th>
          <th>Mean Alignment Score</th>
          <th>Median Alignment Score</th>
          <th>Mean Percentile</th>
          <th>Median Percentile</th>
          <th>Full Edit Distance</th>
          <th>Interior Edit Distance</th>
          <th>Basepair Signature</th>
          <th>2D Diagram</th>
        </tr>
      </thead>
      <tbody>
      {% for result in loop %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <td class="hover-link">
          <input type='radio' name="group" id='s{{ forloop.parentloop.counter }}-{{ forloop.counter }}'
                 class='jmolInline' data-coord='{{ result.motif_id }}'>
          <label for='s{{ forloop.parentloop.counter }}-{{ forloop.counter }}'>{{ result.motif_id }}</label>
          <span class="hover-link-icon">
            <a href="{{ result.motif_url }}" target="_blank">&rarr;</a>
          </span>
        </td>
        <td>{{ result.meanscore|floatformat:4 }}</td>
        <td>{{ result.medianscore|floatformat:4 }}</td>
        <td>{{ result.meanpercentile|floatformat:2 }}</td>
        <td>{{ result.medianpercentile|floatformat:2 }}</td>
        <td>{{ result.medianfulleditdist|floatformat }}</td>
        <td>{{ result.medianinterioreditdist|floatformat }}</td>
        <td>{{ result.signature }}</td>
        <td>
            <a class="fancybox" rel="gallery" href="{{ result.ssurl }}"
               title="Loop {{ forloop.parentloop.counter }} - Hit {{ forloop.counter }} - Motif {{ result.motif_id }}">
                <img class="ss-thumbnail" src="{{ result.ssurl }}"></img>
            </a>
        </td>
      </tr>
      {% endfor %}
      </tbody>
    </table>
    </div>
{% endfor %}
</div>

<div class="span4" id="jmol">
    <script type="text/javascript">
        jmolInitialize(" http://rna.bgsu.edu/img/jmol");
        jmolSetAppletColor("#ffffff");
        jmolApplet(340, "javascript appletLoaded()");
    </script>
    <input type='button' id='neighborhood' class='btn' value="Show neighborhood">
    <input type='button' id='stereo' class='btn' value="Show stereo">
    <input type='button' id='prev' class='btn' value='Previous'>
    <input type='button' id='next' class='btn' value="Next">
    <label><input type="checkbox" id="showNtNums">Numbers</label>
</div>

{{ block.super }}

{% endblock page_content%}

{% block page_specific_js %}
    {{ block.super }}
    <script src="{{ STATIC_URL }}js/jquery.tablesorter.min.js"></script>
    <script src="http://rna.bgsu.edu/img/jmolTools/jquery.jmolTools.js"></script>

    <script>
    $(document).ready(function() {
        $("table").tablesorter();
    });
    // initialize jmolTools
    $('.jmolInline').jmolTools({
        showStereoId: 'stereo',
        showNeighborhoodId: 'neighborhood',
        showNumbersId: 'showNtNums',
        showNextId: 'next',
        showPrevId: 'prev'
    });

    // make sure that jmol is ready
    function appletLoaded (){
        $('.jmolInline').first().jmolToggle();
    }
    </script>

    <script src="{{ STATIC_URL }}js/fancybox/jquery.fancybox.pack.js"></script>
    <link rel="stylesheet" href="{{ STATIC_URL }}js/fancybox/jquery.fancybox.css" type="text/css" media="screen" />

    <script>
    // position jmol
    (function(){
        var reference = $('table').first();
        var offset_left = reference.offset().left + reference.width();
        var offset_top  = reference.offset().top;
        $('#jmol').css('position','fixed')
                  .css('left',offset_left)
                  .css('top',offset_top);
    })();

    // fancybox integration
	$(".fancybox").fancybox({
		openEffect	: 'none',
		closeEffect	: 'none'
	});

    </script>

{% endblock page_specific_js %}
